Name:           @PKGNAME@
Version:        @VERSION@
Release:        @RELEASE@%{?dist}

Summary:        OLPC Firmware Crypto
Group:          Core
License:        GPLv2
Packager:       Martin Langhoff <martin@laptop.org>
URL:            http://wiki.laptop.org/go/Firmware_security
Source0:        http://dev.laptop.org/~douglas/SOURCES/%{name}-%{version}.tar.bz2
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

BuildArch:      i586
BuildRequires:  libgcc
#BuildRequires:  pyrex

Requires:       python
Requires:       mtd-utils
Requires:       bash

%description
Crypto tools for OLPC Firmware. Based on libtomcrypt and libfastmath.

This version of the package is jury-rigged to work on the XS. A proper
distro-quality package would depend on up-to-date libtomcrypt,
libfastmath, etc.

%define debug_package %{nil}

%prep

%setup -q

%build

echo rpm: About to build in $RPM_BUILD_ROOT
make DESTDIR=$RPM_BUILD_ROOT all 

%install
#rm -rf $RPM_BUILD_ROOT
echo rpm: About to install in $RPM_BUILD_ROOT
pwd
make DESTDIR=$RPM_BUILD_ROOT install-rpm
mkdir -p $RPM_BUILD_ROOT/var/lib/olpc-bios-crypto
mkdir -p $RPM_BUILD_ROOT/var/lib/olpc-bios-crypto/server-keys
mkdir -p $RPM_BUILD_ROOT/var/lib/olpc-bios-crypto/server-lease-delegations


%files
%doc cli.README
%doc build/README
#%doc COPYING
%dir /usr/libexec/olpc-bios-crypto
#%dir /usr/bin
%dir /var/lib/olpc-bios-crypto
%dir /var/lib/olpc-bios-crypto/server-keys
%dir /var/lib/olpc-bios-crypto/server-lease-delegations
/usr/bin/obc-*
/usr/libexec/olpc-bios-crypto/

%changelog
* Fri May 8 2009 Martin Langhoff <martin@laptop.org> 0.1-1
  - This is a git-maintaned package - See the changelog at
  http://dev.laptop.org/git/bios-crypto/
(END)
