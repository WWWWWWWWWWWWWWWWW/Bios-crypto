Name:           @PKGNAME@
Version:        @VERSION@
Release:        @RELEASE@%{?dist}

Summary:        OLPC firmware security utilities and libraries
Group:          System Environment/Base
License:        GPLv2+ and Public Domain
URL:            http://wiki.laptop.org/go/Firmware_security
Source0:        http://dev.laptop.org/~douglas/SOURCES/%{name}-%{version}.tar.bz2
BuildRoot:      %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)

Requires:       mtd-utils


%description
Core OLPC crypto libraries.


%package utils
Group: Development/System
Summary: OLPC firmware security utilities
Requires: olpc-bios-crypto = %{version}-%{release}

%description utils
Utilities for working with OLPC's security system. Tools are provided for
signing OS images, generating leases, etc.


%package devel
Group: Development/System
Summary: OLPC firmware utilities development materials
Requires: olpc-bios-crypto = %{version}-%{release}


%description devel
Development materials for olpc-bios-crypto.


%prep
%setup -q


%build
make -C build cli_shared


%install
rm -rf $RPM_BUILD_ROOT
make install DESTDIR=$RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT/var/lib/olpc-bios-crypto
mkdir -p $RPM_BUILD_ROOT/var/lib/olpc-bios-crypto/server-keys
mkdir -p $RPM_BUILD_ROOT/var/lib/olpc-bios-crypto/server-lease-delegations


%post -p /sbin/ldconfig


%postun -p /sbin/ldconfig


%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
#%doc COPYING
%{_libdir}/*.so.*


%files utils
%defattr(-,root,root,-)
%doc build/README
%dir /var/lib/olpc-bios-crypto
%dir /var/lib/olpc-bios-crypto/server-keys
%dir /var/lib/olpc-bios-crypto/server-lease-delegations
%{_bindir}/obc-*
%{_libexecdir}/olpc-bios-crypto/


%files devel
%defattr(-,root,root,-)
%{_includedir}/*
%{_libdir}/*.so


%changelog
* Fri May 8 2009 Martin Langhoff <martin@laptop.org> 0.1-1
  - This is a git-maintaned package - See the changelog at
  http://dev.laptop.org/git/bios-crypto/
(END)
